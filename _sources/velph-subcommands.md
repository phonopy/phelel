(velph_subcommands)=
# `velph` subcommands

The `velph` subcommands, except for {ref}`velph_init` and {ref}`velph_hints`,
are explained on this page.

The following subcommands must be executed in the directory containing the
`velph.toml` file. This ensures that the directories and files generated are
properly organized relative to the current directory where `velph.toml` is
located.

In the following example, two `velph init` command operations generate two
different directories. The first operation performs crystal structure relaxation
in the `relax` directory. The second operation, using the relaxed crystal
structure, carries out additional calculations required for electron-phonon
interactions in the `calc` directory. Details about `velph-tmpl.toml` are
described in {ref}`velph_init_template`.

```
% ls
POSCAR-unitcell  POTCAR  velph-tmpl.toml
% velph init --template-toml velph-tmpl.toml POSCAR-unitcell relax
...
% cd relax
% velph relax generate
...
# Run VASP relaxation calculation
...
% cd ..
% ls
POSCAR-unitcell  POTCAR  relax/  velph-tmpl.toml
% velph init --template-toml velph-tmpl.toml `ls relax/relax/iter*/CONTCAR|tail -n 1` calc
...
% cd calc
% ls
POTCAR  velph.toml
% velph nac generate
VASP input files were made in "nac".
% ls
POTCAR  nac/  velph.toml
...
# Run NAC calculation
...
% velph phelel init
Found "nac" directory. Read NAC params.
"phelel/phelel_disp.yaml" was generated.
VASP input files will be generated by "velph phelel generate".
% velph phelel generate
VASP input files were generated in "phelel/disp-000".
VASP input files were generated in "phelel/disp-001".
VASP input files were generated in "phelel/disp-002".
VASP input files were generated in "phelel/disp-003".
VASP input files were generated in "phelel/disp-004".
% ls
POTCAR  nac/  phelel/  velph.toml
% velph phelel init
Found "nac" directory. Read NAC params.
"phelel/phelel_disp.yaml" was generated.
VASP input files will be generated by "velph phelel generate".
...
```

## `velph phelel`

This subcommand calculates the derivatives of local potentials and PAW strengths
with respect to displacement, performing similar operations as steps 1 and 3
carried out by the `phelel` command in the {ref}`workflow <workflow_minimal>`.

### `velph phelel init`

### `velph phelel generate`

### `velph phelel differentiate`

### `velph phelel phonopy`

## `velph transport`

### `velph transport generate`

### `velph transport plot`

## `velph relax`

It is recommended to create a project directory secific for relaxation
calculation, e.g., by

```
% ls
POSCAR-unitcell  POTCAR  velph-tmpl.toml
% velph init --template-toml velph-tmpl.toml POSCAR-unitcell relax
...
% cd relax
% ls
POTCAR  velph.toml
% velph relax generate
...
```

### `velph relax generate`

This subcommand prepares VASP input files and a job script for crystal structure
relaxation. Multiple relaxation calculations can be performed. In such cases,
the `CONTCAR` from the previous calculation is used as the `POSCAR` for the next
calculation to generate a new set of VASP input files.

```
% ls
POTCAR  velph.toml
% velph relax generate
VASP input files were made in "relax/iter1".
...
# Run VASP calculation in relax/iter1
...
% ls
POTCAR  relax/  velph.toml
% velph relax generate
"relax/iter1" exists.
"relax/iter1/CONTCAR" will be as new "POSCAR".
VASP input files were made in "relax/iter2".
...
```

## `velph nac`

This subcommand is used to calculate dielectric constant and Born effective
charges that are used for non-analytical term correction of phonon calculation
and treatment of long range term of electron phonon interaction.

### `velph nac generate`

## `velph el_bands`

### `velph el_bands generate`
### `velph el_bands plot`

## `velph ph_bands`

### `velph ph_bands generate`

### `velph ph_bands plot`

## `velph phono3py`

### `velph phono3py init`

### `velph phono3py generate`

## `velph phonopy`

### `velph phonopy init`

### `velph phonopy generate`
